<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="TemplateMo">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">

    <title>Capti - on</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-finance-business.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.css') }}">

  </head>

  <body>

    <!-- ***** Preloader Start ***** -->
    <!-- <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>   -->
    <!-- ***** Preloader End ***** -->

    <!-- Header -->
    <div class="sub-header">
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-xs-12">
            <ul class="left-info">
              <li><a href="#"><i class="fa fa-clock-o"></i>Mon-Fri 09:00-05:00</a></li>
              <li><a href="#"><i class="fa fa-phone"></i>1234567890</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="right-icons">
              <li><a href="#"><i class="fa fa-facebook"></i></a></li>
              <li><a href="#"><i class="fa fa-twitter"></i></a></li>
              <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <header class="">
      <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a class="navbar-brand" href="{{ url_for('home') }}"><h2>Capti - on</h2></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="{{ url_for('home') }}">Home
                  <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('about') }}">About Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('services') }}">Our Services</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('capti') }}">Image Captioning</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('contact') }}">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Page Content -->
    <!-- Banner Starts Here -->
    <div class="main-banner header-text" id="top">
        <div class="Modern-Slider">
          <!-- Item -->
          <div class="item item-1">
            <div class="img-fill">
                <div class="text-content">
                  <h6>we are ready to help you</h6>
                  <h4>E-commerce Strategy<br>&amp;  Consulting</h4>

                  <p>The Ultimate Platform for Smarter Search Experiences</p>
                  <a href="{{ url_for('contact') }}" class="filled-button">contact us</a>
                </div>
            </div>
          </div>
          <!-- // Item -->
          <!-- Item -->
          <div class="item item-2">
            <div class="img-fill">
                <div class="text-content">
                  <h6>we are here to support you</h6>
                  <h4>Intelligent Solutions<br>&amp; Future-Ready Consulting</h4>

                  <p>Transform Your Online Presence with AI-Driven Strategies</p>
                  <a href="{{ url_for('services') }}" class="filled-button">our services</a>
                </div>
            </div>
          </div>
          <!-- // Item -->
          <!-- Item -->
          <div class="item item-3">
            <div class="img-fill">
                <div class="text-content">
                  <h6>we have a solid background</h6>
                  <h4>AI Solutions<br>&amp; Automation Solutions</h4>

                  <p>Crafting insights-driven strategies to boost engagement and growth.</p>
                  <a href="{{ url_for('about') }}" class="filled-button">learn more</a>
                </div>
            </div>
          </div>
          <!-- // Item -->
        </div>
    </div>
    <!-- Banner Ends Here -->

    <div class="request-form">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <h4>Let‚Äôs Talk About Growing Your Brand.</h4>
            <span>Let‚Äôs Connect.</span>
          </div>
          <div class="col-md-4">
            <a href="{{ url_for('contact') }}" class="border-button">Contact Us</a>
          </div>
        </div>
      </div>
    </div>

    <div class="services">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="section-heading">
              <h2>Marketing <em>Services</em></h2>
              <span>Get customized solutions that drive real growth for your business</span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="service-item">
              
              <img src="{{ url_for('static', filename='images/voice_assis.jpg') }}" alt="">
              <div class="down-content">
                <h4>Voice Assistant</h4>
                <p>Give your customers a voice. Provide instant support, answer queries, and deliver seamless experiences with AI-powered voice assistants tailored to your brand.</p>
                <a href="{{ url_for('services') }}" class="filled-button">Read More</a>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="service-item">
              <img src="{{ url_for('static', filename='images/AI_chat.jpg') }}" alt="">
              <div class="down-content">
                <h4>Chatbot</h4>
                <p>Engage your customers 24/7 with AI-driven chatbots that resolve queries, offer personalized support, and enhance customer satisfaction effortlessly.</p>
                <a href="/services" class="filled-button">Read More</a>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="service-item">
              <img src="{{ url_for('static', filename='images/capti.png') }}" alt="" style="height:200px", "width:200px">
              <div class="down-content">
                <h4>Image Caption</h4>
                <p>Add meaning to every visual with AI-powered image captions that explain, engage, and connect your brand with clarity.</p>
                <a href="/services" class="filled-button">Read More</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="fun-facts">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <div class="left-content">
              
              <h2>Our solutions for your <em>business growth</em></h2>
              <p>We provide innovative, results-driven strategies to help your business thrive in the digital world. From building your brand presence to increasing conversions, our customized solutions are designed to deliver measurable success.
              <br><br>Unlock new opportunities, reach the right audience, and stay ahead of the competition with our expert-driven approach to growth.</p>
              <a href="{{ url_for('about') }}" class="filled-button">Read More</a>
            </div>
          </div>
          <div class="col-md-6 align-self-center">
            <div class="row">
              <div class="col-md-6">
                <div class="count-area-content">
                  <div class="count-digit">945</div>
                  <div class="count-title">Work Hours</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="count-area-content">
                  <div class="count-digit">80</div>
                  <div class="count-title">Great Reviews</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="count-area-content">
                  <div class="count-digit">8</div>
                  <div class="count-title">Projects Done</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="count-area-content">
                  <div class="count-digit">1</div>
                  <div class="count-title">Awards Won</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="more-info">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="more-info-content">
              <div class="row">
                <div class="col-md-6">
                  <div class="left-image">
                    <img src="{{ url_for('static', filename='images/abo.jpg') }}" alt="">
                  </div>
                </div>
                <div class="col-md-6 align-self-center">
                  <div class="right-content">
                    <span>Who we are</span>
                    <h2>Get to know about <em>our Website</em></h2>
                    <p>We help e-commerce businesses unlock their full potential with intelligent AI solutions. Our AI agent streamlines operations, improves customer experience, and maximizes revenue ‚Äî giving you the competitive edge in today‚Äôs fast-paced market.<br><br>With expertise in automation, data analytics, and personalized marketing, we empower brands to focus on what they do best ‚Äî while we handle the rest.</p>
                    <a href="#" class="filled-button">Read More</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="testimonials">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="section-heading">
              <h2>What they say <em>about us</em></h2>
              <span>What Our Clients Say About Us</span>
            </div>
          </div>
          <div class="col-md-12">
            <div class="owl-testimonials owl-carousel">
              
              <div class="testimonial-item">
                <div class="inner-content">
                  <h4>Megha</h4>
                  <span>Financial Analyst</span>
                  <p>"This AI platform completely transformed my store operations. Customer support is now instant, and my sales have increased by 40% in just three months!"</p>
                </div>
                <img src="http://placehold.it/60x60" alt="">
              </div>
              
              <div class="testimonial-item">
                <div class="inner-content">
                  <h4>Pallavi</h4>
                  <span>Market Specialist</span>
                  <p>"The insights from this AI tool are game-changing. We‚Äôve made smarter decisions, cut costs, and improved customer satisfaction across the board."</p>
                </div>
                <img src="http://placehold.it/60x60" alt="">
              </div>
              
              <div class="testimonial-item">
                <div class="inner-content">
                  <h4>Menuka</h4>
                  <span>Chief Accountant</span>
                  <p>"I love how everything is automated. Marketing campaigns practically run themselves, and I can finally focus on growing my business."</p>
                </div>
                <img src="http://placehold.it/60x60" alt="">
              </div>
              
              <div class="testimonial-item">
                <div class="inner-content">
                  <h4>Afiya</h4>
                  <span>Marketing Head</span>
                  <p>"The product recommendations are spot on. Our average order value went up significantly, and inventory management has never been easier."</p>
                </div>
                <img src="http://placehold.it/60x60" alt="">
              </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="callback-form">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="section-heading">
              <h2>Connect With Our Team</h2>
              <span>Let‚Äôs Build Success Together</span>
            </div>
          </div>
          <div class="col-md-12">
            <div class="contact-form">
              <form id="contact" action="/contact" method="post">
                <div class="row">
                  <div class="col-lg-4 col-md-12 col-sm-12">
                    <fieldset>
                      <input name="name" type="text" class="form-control" id="name" placeholder="Full Name" required="">
                    </fieldset>
                  </div>
                  <div class="col-lg-4 col-md-12 col-sm-12">
                    <fieldset>
                      <input name="email" type="text" class="form-control" id="email" pattern="[^ @]*@[^ @]*" placeholder="E-Mail Address" required="">
                    </fieldset>
                  </div>
                  <div class="col-lg-4 col-md-12 col-sm-12">
                    <fieldset>
                      <input name="subject" type="text" class="form-control" id="subject" placeholder="Subject" required="">
                    </fieldset>
                  </div>
                  <div class="col-lg-12">
                    <fieldset>
                      <textarea name="message" rows="6" class="form-control" id="message" placeholder="Your Message" required=""></textarea>
                    </fieldset>
                  </div>
                  <div class="col-lg-12">
                    <fieldset>
                      <button type="submit" id="form-submit" class="border-button">Send Message</button>
                    </fieldset>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  <br><br><br>
  <!--  <div class="partners">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="owl-partners owl-carousel">
            
              <div class="partner-item">
                <img src="{{ url_for('static', filename='images/logo1.webp') }}" title="1" alt="1">
              </div>
              
              <div class="partner-item">
                <img src="{{ url_for('static', filename='images/logo1.webp') }}" title="2" alt="2">
              </div>
              
              <div class="partner-item">
                <img src="{{ url_for('static', filename='images/logo1.webp') }}" title="3" alt="3">
              </div>
              
              <div class="partner-item">
                <img src="{{ url_for('static', filename='images/logo1.webp') }}" title="4" alt="4">
              </div>
              
              <div class="partner-item">
                <img src="{{ url_for('static', filename='images/logo1.webp') }}" title="5" alt="5">
              </div>
              
            </div>-->
          </div>
        </div>
      </div>
    </div>


    <!-- Footer Starts Here -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-3 footer-item">
            <h4>E-commerce</h4>
            <p>Grow your online store with AI-powered solutions that boost sales, improve customer experiences, and simplify operations ‚Äî helping your business scale effortlessly.</p>
            <ul class="social-icons">
              <li><a rel="nofollow" href="https://fb.com/templatemo" target="_blank"><i class="fa fa-facebook"></i></a></li>
              <li><a href="#"><i class="fa fa-twitter"></i></a></li>
              <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
              
            </ul>
          </div>
          <!--<div class="col-md-3 footer-item">
            <h4>Useful Links</h4>
            <ul class="menu-list">
              <li><a href="#">Vivamus ut tellus mi</a></li>
              <li><a href="#">Nulla nec cursus elit</a></li>
              <li><a href="#">Vulputate sed nec</a></li>
              <li><a href="#">Cursus augue hasellus</a></li>
              <li><a href="#">Lacinia ac sapien</a></li>
            </ul>
          </div>-->
          <div class="col-md-3 footer-item">
            <h4>Additional Pages</h4>
            <ul class="menu-list">
              <li><a href="/about">About Us</a></li>
              <li><a href="/services">How We Work</a></li>
              <li><a href="/contact">Quick Support</a></li>
              <li><a href="/contact">Contact Us</a></li>
              <li><a href="/privacy">Privacy Policy</a></li>
            </ul>
          </div>
          <div class="col-md-3 footer-item last-item">
            <h4>Contact Us</h4>
            <div class="contact-form">
              <form id="contact footer-contact" action="/contact" method="post">
                <div class="row">
                  <div class="col-lg-12 col-md-12 col-sm-12">
                    <fieldset>
                      <input name="name" type="text" class="form-control" id="name" placeholder="Full Name" required="">
                    </fieldset>
                  </div>
                  <div class="col-lg-12 col-md-12 col-sm-12">
                    <fieldset>
                      <input name="email" type="text" class="form-control" id="email" pattern="[^ @]*@[^ @]*" placeholder="E-Mail Address" required="">
                    </fieldset>
                  </div>
                  <div class="col-lg-12">
                    <fieldset>
                      <textarea name="message" rows="6" class="form-control" id="message" placeholder="Your Message" required=""></textarea>
                    </fieldset>
                  </div>
                  <div class="col-lg-12">
                    <fieldset>
                      <button type="submit" id="form-submit" class="filled-button">Send Message</button>
                    </fieldset>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </footer>
    
    <div class="sub-footer">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <p>Copyright &copy; 2025 E-commerce Co., Ltd. </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

    <!-- Additional Scripts -->
    <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
    <script src="{{ url_for('static', filename='js/owl.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick.js') }}"></script>
    <script src="{{ url_for('static', filename='js/accordions.js') }}"></script>

    <script language = "text/Javascript"> 
      cleared[0] = cleared[1] = cleared[2] = 0; //set a cleared flag for each field
      function clearField(t){                   //declaring the array outside of the
      if(! cleared[t.id]){                      // function makes it static and global
          cleared[t.id] = 1;  // you could use true and false, but that's more typing
          t.value='';         // with more chance of typos
          t.style.color='#fff';
          }
      }
    </script>
<!-- ===== Floating Chatbot  ===== -->
<!-- Inline SVG typing-bubble icon (scalable) -->
<div id="chatbot-root">
  <button id="chatbot-button" aria-label="Open Chat">
    <!-- animated typing bubble SVG -->
    <svg id="chat-svg" viewBox="0 0 24 24" width="28" height="28" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path d="M3 12a9 9 0 0 1 9-9h0a9 9 0 0 1 0 18H9l-4 3V12z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
      <!-- three animated dots -->
      <g id="dots" fill="currentColor">
        <circle cx="8.8" cy="11.4" r="0.9" opacity="0.9">
          <animate attributeName="r" values="0.9;1.8;0.9" dur="1s" repeatCount="indefinite" begin="0s" />
        </circle>
        <circle cx="12" cy="11.4" r="0.9" opacity="0.9">
          <animate attributeName="r" values="0.9;1.9;0.9" dur="1s" repeatCount="indefinite" begin="0.12s" />
        </circle>
        <circle cx="15.2" cy="11.4" r="0.9" opacity="0.9">
          <animate attributeName="r" values="0.9;1.8;0.9" dur="1s" repeatCount="indefinite" begin="0.24s" />
        </circle>
      </g>
    </svg>
    <!-- GIF fallback (hidden by default) -->
    <img id="chat-gif" src="/static/chat-typing.gif" alt="Chat" style="display:none;width:36px;height:36px;border-radius:8px;">
  </button>

  <div id="chatbot-popup" role="dialog" aria-label="Chatbot window">
    <div id="chatbar">
      <div id="chat-title">Caption Assistant</div>
      <div id="chat-controls">
        <button id="minimize-btn" title="Minimize">‚Äî</button>
        <button id="close-btn" title="Close">‚úï</button>
      </div>
    </div>
    <iframe id="chatbot-iframe" src="{{ url_for('chatbot') }}"></iframe>
    <!-- Resize handle (bottom-right) -->
    <div id="resize-handle" aria-hidden="true"></div>
  </div>
</div>

<!-- ===== Styles ===== -->
<style>
  :root {
    --chat-bg: #ffffff;
    --chat-accent: #4f46e5; /* default accent (can match Tailwind indigo-600) */
    --chat-text: #111827;
    --chat-muted: #6b7280;
    --chat-border: rgba(0,0,0,0.08);
    --chat-width: 380px;
    --chat-height: 520px;
  }

  /* dark mode */
  @media (prefers-color-scheme: dark) {
    :root {
      --chat-bg: #0f172a;
      --chat-accent: #7c3aed;
      --chat-text: #e6edf3;
      --chat-muted: #9ca3af;
      --chat-border: rgba(255,255,255,0.06);
    }
  }

  /* container */
  #chatbot-root { position: fixed; z-index: 10000; right: 20px; bottom: 20px; font-family: Inter, system-ui, Arial, sans-serif; }

  /* button */
  #chatbot-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 64px;
    height: 64px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg,var(--chat-accent), #2b6ff6);
    color: white;
    box-shadow: 0 8px 24px rgba(16,24,40,0.25);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  #chatbot-button:hover { transform: translateY(-4px) scale(1.04); box-shadow: 0 12px 34px rgba(16,24,40,0.32); }
  #chatbot-button:active { transform: translateY(-1px); }

  #chat-svg { pointer-events: none; }
  #chat-gif { pointer-events: none; }

  /* popup */
  #chatbot-popup {
    position: fixed;
    right: 20px;
    bottom: 100px;
    width: var(--chat-width);
    height: var(--chat-height);
    background: var(--chat-bg);
    border-radius: 12px;
    border: 1px solid var(--chat-border);
    box-shadow: 0 18px 50px rgba(2,6,23,0.35);
    overflow: hidden;
    display: none;
    resize: both;          /* native resize handle (works in many browsers) */
    overflow: auto;
    touch-action: none;    /* help dragging on touch */
  }

  /* glow animation when reply arrives */
  #chatbot-popup.reply-anim {
    animation: glowPulse 1.1s ease;
    box-shadow: 0 20px 60px rgba(124,58,237,0.18);
  }
  @keyframes glowPulse {
    0% { box-shadow: 0 0 0 rgba(124,58,237,0.0); transform: translateY(0); }
    30% { box-shadow: 0 0 20px rgba(124,58,237,0.18); transform: translateY(-2px); }
    100% { box-shadow: 0 6px 30px rgba(2,6,23,0.18); transform: translateY(0); }
  }

  /* chatbar */
  #chatbar { display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding: 10px 12px; background: linear-gradient(180deg, rgba(0,0,0,0.03), transparent); border-bottom: 1px solid var(--chat-border);
    cursor: move; user-select: none;
  }
  #chat-title { font-weight: 600; color: var(--chat-text); }
  #chat-controls button { background: transparent; border: none; color: var(--chat-muted); font-size: 16px; cursor: pointer; padding: 6px; border-radius: 6px; }
  #chat-controls button:hover { background: rgba(0,0,0,0.04); }

  iframe#chatbot-iframe { width: 100%; height: calc(100% - 46px); border: none; display: block; }

  /* resizer handle bottom-right */
  #resize-handle { position: absolute; right: 6px; bottom: 6px; width: 18px; height: 18px; cursor: se-resize; border-radius: 4px; opacity: 0.6; }
  #resize-handle:after { content: ""; position:absolute; right:4px; bottom:4px; width:10px; height:10px; border-right:2px solid var(--chat-border); border-bottom:2px solid var(--chat-border); transform: rotate(0deg); }

  /* small screens: expand popup a little */
  @media (max-width: 480px) {
    #chatbot-popup { width: calc(100% - 32px); height: 66vh; right: 16px; bottom: 80px; }
    #chatbot-button { width: 56px; height: 56px; }
  }
</style>

<!-- ===== Script: toggle, drag, resize, receive reply message, play sound ===== -->
<script>
  (function () {
    const btn = document.getElementById("chatbot-button");
    const popup = document.getElementById("chatbot-popup");
    const iframe = document.getElementById("chatbot-iframe");
    const closeBtn = document.getElementById("close-btn");
    const minimizeBtn = document.getElementById("minimize-btn");
    const resizeHandle = document.getElementById("resize-handle");
    const chatbar = document.getElementById("chatbar");

    // toggle open/close
    btn.addEventListener("click", () => {
      popup.style.display = popup.style.display === "block" ? "none" : "block";
    });
    closeBtn.addEventListener("click", () => popup.style.display = "none");
    minimizeBtn.addEventListener("click", () => {
      popup.style.display = popup.style.display === "block" ? "none" : "block";
    });

    // drag logic
    let isDragging = false;
    let dragStart = {x:0, y:0};
    let popupStart = {x:0, y:0};
    function getPopupRect() { return popup.getBoundingClientRect(); }

    function pointerDown(e) {
      isDragging = true;
      dragStart = { x: e.clientX || e.touches[0].clientX, y: e.clientY || e.touches[0].clientY };
      const r = getPopupRect();
      popupStart = { x: r.right, y: r.bottom };
      popup.style.transition = "none";
      document.addEventListener("pointermove", pointerMove);
      document.addEventListener("pointerup", pointerUp);
    }
    function pointerMove(e) {
      if (!isDragging) return;
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      const dx = dragStart.x - clientX;
      const dy = dragStart.y - clientY;

      // compute new positions (right & bottom)
      const newRight = (window.innerWidth - (popupStart.x - dx)) + "px";
      const newBottom = (window.innerHeight - (popupStart.y - dy)) + "px";
      popup.style.right = newRight;
      popup.style.bottom = newBottom;
    }
    function pointerUp() {
      isDragging = false;
      popup.style.transition = "";
      document.removeEventListener("pointermove", pointerMove);
      document.removeEventListener("pointerup", pointerUp);
    }
    // wire drag start on chatbar
    chatbar.addEventListener("pointerdown", pointerDown);

    // resizer (manual)
    let isResizing = false;
    let resizeStart = {};
    resizeHandle.addEventListener("pointerdown", (e) => {
      isResizing = true;
      resizeStart = { x: e.clientX, y: e.clientY, w: popup.offsetWidth, h: popup.offsetHeight };
      document.addEventListener("pointermove", doResize);
      document.addEventListener("pointerup", stopResize);
      e.preventDefault();
    });
    function doResize(e) {
      if (!isResizing) return;
      const dx = e.clientX - resizeStart.x;
      const dy = e.clientY - resizeStart.y;
      const newW = Math.max(280, resizeStart.w + dx);
      const newH = Math.max(320, resizeStart.h + dy);
      popup.style.width = newW + "px";
      popup.style.height = newH + "px";
    }
    function stopResize() {
      isResizing = false;
      document.removeEventListener("pointermove", doResize);
      document.removeEventListener("pointerup", stopResize);
    }

    // reply animation + sound when iframe informs parent
    window.addEventListener("message", (ev) => {
      // only accept messages with type 'gemini_reply'
      if (!ev.data || ev.data.type !== "gemini_reply") return;
      // add class to animate
      popup.classList.add("reply-anim");
      setTimeout(() => popup.classList.remove("reply-anim"), 1200);

      // play chime
      playChime();
      // briefly show a small pulse on the button
      btn.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.08)' }, { transform: 'scale(1)' }], { duration: 450, easing: 'ease' });
    });

    // Web Audio chime (no file)
    function playChime() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 880; // start freq
        g.gain.value = 0.0001;
        o.connect(g);
        g.connect(ctx.destination);
        const now = ctx.currentTime;
        // short chirp
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.06, now + 0.02);
        o.frequency.setValueAtTime(880, now);
        o.frequency.exponentialRampToValueAtTime(1320, now + 0.08);
        g.gain.exponentialRampToValueAtTime(0.0001, now + 0.35);
        o.start(now);
        o.stop(now + 0.38);
      } catch (e) {
        // ignore if audio not allowed
        console.warn("Audio play failed", e);
      }
    }

    // Optional: close if clicked outside (but keep button clickable)
    document.addEventListener("click", (ev) => {
      if (!popup.contains(ev.target) && !btn.contains(ev.target)) {
        // keep hidden only if open
        // popup.style.display = "none";
      }
    });

    // Expose a small API for debugging:
    window.__chatbotPopup = { open: () => popup.style.display = "block", close: () => popup.style.display = "none" };
  })();
   const chatbox = document.getElementById("chatbox");
  const typing = document.getElementById("typing");
  const previewDiv = document.getElementById("preview");
  let capturedImage = null;

  async function sendMessage() {
    const input = document.getElementById("userInput");
    const message = input.value.trim();
    if (!message && !capturedImage) return;

    // show user message
    const userDiv = document.createElement("div");
    userDiv.className = "msg user";
    userDiv.textContent = message || "[üì∏ Image]";
    chatbox.appendChild(userDiv);
    chatbox.scrollTop = chatbox.scrollHeight;

    input.value = "";
    previewDiv.innerHTML = "";
    typing.style.display = "block";

    try {
      const res = await fetch("/chatbot_api", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message, image: capturedImage })
      });
      const data = await res.json();
      typing.style.display = "none";

      const botDiv = document.createElement("div");
      botDiv.className = "msg bot";
      botDiv.textContent = data.response;
      chatbox.appendChild(botDiv);
      chatbox.scrollTop = chatbox.scrollHeight;

      // Notify parent window so it can animate and play sound
      if (window.parent) {
        window.parent.postMessage({ type: "gemini_reply", text: data.response }, "*");
      }
    } catch (err) {
      typing.style.display = "none";
      const errDiv = document.createElement("div");
      errDiv.className = "msg bot";
      errDiv.textContent = "‚ö†Ô∏è Error sending request.";
      chatbox.appendChild(errDiv);
      chatbox.scrollTop = chatbox.scrollHeight;
    } finally {
      capturedImage = null;
    }
  }

</script>

  </body>
</html>